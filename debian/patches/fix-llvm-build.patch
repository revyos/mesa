Description: fix llvm gcc build
Author: Han Gao <gaohan@iscas.ac.cn>

Last-Update: 2023-09-04

Index: mesa-21.2.1/src/amd/compiler/aco_instruction_selection.cpp
===================================================================
--- mesa-21.2.1.orig/src/amd/compiler/aco_instruction_selection.cpp
+++ mesa-21.2.1/src/amd/compiler/aco_instruction_selection.cpp
@@ -41,6 +41,7 @@
 #include <numeric>
 #include <stack>
 #include <vector>
+#include <utility>
 
 namespace aco {
 namespace {
Index: mesa-21.2.1/src/amd/llvm/ac_llvm_helper.cpp
===================================================================
--- mesa-21.2.1.orig/src/amd/llvm/ac_llvm_helper.cpp
+++ mesa-21.2.1/src/amd/llvm/ac_llvm_helper.cpp
@@ -60,7 +60,7 @@ bool ac_is_sgpr_param(LLVMValueRef arg)
    llvm::Argument *A = llvm::unwrap<llvm::Argument>(arg);
    llvm::AttributeList AS = A->getParent()->getAttributes();
    unsigned ArgNo = A->getArgNo();
-   return AS.hasAttribute(ArgNo + 1, llvm::Attribute::InReg);
+   return AS.hasParamAttr(ArgNo, llvm::Attribute::InReg);
 }
 
 LLVMValueRef ac_llvm_get_called_value(LLVMValueRef call)
Index: mesa-21.2.1/src/gallium/frontends/clover/llvm/codegen/common.cpp
===================================================================
--- mesa-21.2.1.orig/src/gallium/frontends/clover/llvm/codegen/common.cpp
+++ mesa-21.2.1/src/gallium/frontends/clover/llvm/codegen/common.cpp
@@ -230,8 +230,8 @@ namespace {
                }
 
             } else {
-               const bool needs_sign_ext = f.getAttributes().hasAttribute(
-                  arg.getArgNo() + 1, ::llvm::Attribute::SExt);
+               const bool needs_sign_ext = f.getAttributes().hasParamAttr(
+                  arg.getArgNo(), ::llvm::Attribute::SExt);
 
                args.emplace_back(module::argument::scalar, arg_api_size,
                                  target_size, target_align,
Index: mesa-21.2.1/src/gallium/frontends/clover/llvm/codegen/native.cpp
===================================================================
--- mesa-21.2.1.orig/src/gallium/frontends/clover/llvm/codegen/native.cpp
+++ mesa-21.2.1/src/gallium/frontends/clover/llvm/codegen/native.cpp
@@ -28,7 +28,7 @@
 ///
 
 #include <llvm/Target/TargetMachine.h>
-#include <llvm/Support/TargetRegistry.h>
+#include <llvm/MC/TargetRegistry.h>
 #include <llvm/Transforms/Utils/Cloning.h>
 
 #include "llvm/codegen.hpp"
